"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[346],{80346:(T,d,a)=>{a.r(d),a.d(d,{SunactivPageModule:()=>b});var f=a(36895),S=a(24006),o=a(48058),p=a(64228),y=a(65414),m=a(22727),t=a(98274),P=a(45340),v=a(54463),w=a(30735),M=a(77220),A=a(53025),x=a(42045),_=a(43485),O=a(18828);function Z(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"ion-row",8),t._UZ(1,"ion-col",9),t.TgZ(2,"ion-col",10)(3,"img",11),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.syncGoogleFit())}),t.qZA(),t.TgZ(4,"p",12),t._uU(5),t.ALo(6,"translate"),t.qZA()(),t._UZ(7,"ion-col",9),t.qZA()}2&i&&(t.xp6(5),t.Oqu(t.lcZ(6,1,"sunactiv.google_heading")))}function D(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"ion-row",8),t._UZ(1,"ion-col",9),t.TgZ(2,"ion-col",10)(3,"img",13),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.syncAppleHealth())}),t.qZA(),t.TgZ(4,"p",12),t._uU(5),t.ALo(6,"translate"),t.qZA()(),t._UZ(7,"ion-col",9),t.qZA()}2&i&&(t.xp6(5),t.Oqu(t.lcZ(6,1,"sunactiv.apple_heading")))}const C=[{path:"",component:(()=>{class i{constructor(e,s,n,l,r,g,u,h,E,R,L){this.translateConfigService=e,this.modalCtrl=s,this.translate=n,this.sunactivService=l,this.health=r,this.utils=g,this.iab=u,this.alertCtrl=h,this.config=E,this.router=R,this.appAvailability=L,this.PlatformiOS=!1,this.selectedLanguage=this.translateConfigService.getDefaultLanguage(),this.translateConfigService.setLanguage("en"),this.utils.getPlatform()==this.config.sunactiv.platform_ios&&(this.PlatformiOS=!0),this.status=history.state.status,this.avgStepMonth=history.state.avgStepMonth,this.source=history.state.source,this.RegMSecDate=history.state.RegDate,this.RegDate=new Date(this.RegMSecDate),this.lastSyncMsecDate=history.state.lastSyncDate,this.lastSyncDate=new Date(this.lastSyncMsecDate),this.isRegistered=history.state.registered,this.previousMonthStatus=history.state.previousMonthStatus,history.state.manualUnsync&&this.updateSunActivUser(this.config.sunactiv.source_unsync)}ionViewDidEnter(){this.config.currentPage.pageName="SunactivPage"}ionViewWillEnter(){this.utils.component.emit(y.c.SunActiv)}syncGoogleFit(){if(this.utils.isDeviceOnLine())this.appAvailability.check(this.config.sunactiv.google_fit_package_name).then(s=>{this.authorizeGoogleFit()},s=>{this.promptInstallApp(this.config.sunactiv.prompt_install_google_fit_title,this.config.sunactiv.prompt_install_google_fit_desc,this.config.sunactiv.source_google)});else{let e=this.translate.instant("generic_msgs.network_err");this.showError(e)}}syncAppleHealth(){if(this.utils.isDeviceOnLine())this.authorizeGoogleFit();else{let e=this.translate.instant("generic_msgs.network_err");this.showError(e)}}authorizeGoogleFit(){this.health.isAvailable().then(e=>{e?this.health.requestAuthorization([{read:["steps"]}]).then(s=>{var n;this.PlatformiOS?this.checkReadPermission():(n=this.config.sunactiv.source_google,this.isRegistered?this.updateSunActivUser(n):this.registerSunActivUser(n))}).catch(s=>{this.showError(this.config.sunactiv.error_auth_failed)}):this.showError(this.PlatformiOS?this.config.sunactiv.ipad_health_not_available:this.config.sunactiv.health_not_available)}).catch(e=>{this.showError(this.config.sunactiv.health_not_available)})}checkReadPermission(){var e=this.config.sunactiv.source_apple;this.health.isAvailable().then(s=>{this.health.requestAuthorization([{read:["steps"]}]).then(n=>{var r=new Date;r.setDate(r.getDate()-30),this.health.queryAggregated({startDate:r,endDate:new Date,dataType:"steps",bucket:"day",filtered:!0}).then(g=>{for(var u=0,h=0;h<g.length;h++)u+=parseInt(g[h].value);this.utils.dissmisProgressLoader(),0==u?this.showError(this.config.sunactiv.ios_read_permissions_not_available):this.isRegistered?this.updateSunActivUser(e):this.registerSunActivUser(e)})})})}promptInstallApp(e,s,n){this.alertCtrl.create({header:e,message:s,buttons:[{text:"Disagree",handler:()=>{}},{text:"Agree",handler:()=>{n==this.config.sunactiv.source_google?this.health.promptInstallFit():this.iab.create(this.config.sunactiv.sumsungApp_url,"_system").show()}}]}).then(r=>r.present())}registerSunActivUser(e){if(this.utils.isDeviceOnLine())this.utils.showProgressLoader(),this.sunactivService.postSunActivUserRegister(e).then(s=>{try{if(s.responseJSON&&s.responseJSON.statusCode==m.oo){this.utils.dissmisProgressLoader();var n=s.responseJSON;this.router.navigate(["//sunactiv-dashboard"],{state:{registered:!0,source:n.source,status:n.status,previousMonthStatus:n.PreviousStatus,avgStepMonth:n.averageStepsThisMonth,RegDate:n.registrationDate,lastSyncDate:n.lastSyncDate}})}}catch(l){let r=this.translate.instant("generic_msgs.server_err");this.showError(r)}},s=>{let n=this.utils.handleServiceException(s);this.showError(n)});else{let s=this.translate.instant("generic_msgs.network_err");this.showError(s)}}updateSunActivUser(e){if(this.utils.isDeviceOnLine())this.utils.showProgressLoader(),this.sunactivService.PutSunActivUser(e).then(s=>{try{s.responseJSON&&s.responseJSON.statusCode==m.OK&&(this.utils.dissmisProgressLoader(),e!=this.config.sunactiv.source_unsync&&this.router.navigate(["/sunactiv-dashboard"],{state:{registered:this.isRegistered,source:e,status:this.status,previousMonthStatus:this.previousMonthStatus,avgStepMonth:this.avgStepMonth,RegDate:this.RegDate,lastSyncDate:this.lastSyncDate}}))}catch(n){let l=this.translate.instant("generic_msgs.server_err");this.showError(l)}},s=>{let n=this.utils.handleServiceException(s);this.showError(n)});else{let s=this.translate.instant("generic_msgs.network_err");this.showError(s)}}showError(e){this.utils.dissmisProgressLoader(),this.utils.showAlert("",e)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(P.w),t.Y36(o.IN),t.Y36(v.sK),t.Y36(w.F),t.Y36(M.S),t.Y36(A.f),t.Y36(x.i),t.Y36(o.Br),t.Y36(_.i),t.Y36(p.F0),t.Y36(O.F))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-sunactiv"]],decls:17,vars:11,consts:[["mode","ios"],["color","primary"],["slot","start","auto-hide","false","color","secondary"],[1,"bold-font"],[1,"sunactiv","ion-padding"],[1,"sunactiv-heading"],[1,"sync-heading"],["style","margin-top: 20px;",4,"ngIf"],[2,"margin-top","20px"],["size","3",1,"text-center"],["size","6",1,"text-center"],["src","./assets/imgs/google-health-new.png","alt","...",1,"source-name-image",3,"click"],[1,"source-name"],["src","./assets/imgs/apple-health-new.png","alt","...",1,"source-name-image-apple",3,"click"]],template:function(e,s){1&e&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar",1),t._UZ(2,"ion-menu-button",2),t.TgZ(3,"ion-title",3),t._uU(4),t.ALo(5,"translate"),t.qZA()()(),t.TgZ(6,"ion-content",4)(7,"ion-row")(8,"div",5)(9,"p",6),t._uU(10),t.ALo(11,"translate"),t._UZ(12,"br"),t._uU(13),t.ALo(14,"translate"),t.qZA()()(),t.YNc(15,Z,8,3,"ion-row",7),t.YNc(16,D,8,3,"ion-row",7),t.qZA()),2&e&&(t.xp6(4),t.Oqu(t.lcZ(5,5,"sunactiv.sunactiv_title")),t.xp6(6),t.Oqu(t.lcZ(11,7,"sunactiv.sync_heading")),t.xp6(3),t.Oqu(t.lcZ(14,9,"sunactiv.sync_heading2")),t.xp6(2),t.Q6J("ngIf",!s.PlatformiOS),t.xp6(1),t.Q6J("ngIf",s.PlatformiOS))},dependencies:[f.O5,o.wI,o.W2,o.Gu,o.fG,o.Nd,o.wd,o.sr,v.X$],styles:[".sunactiv-heading[_ngcontent-%COMP%]{text-align:center;width:100%;position:relative;min-height:1px;padding-left:15px;padding-right:15px;float:left}.text-center[_ngcontent-%COMP%]{text-align:center}.row[_ngcontent-%COMP%]{height:20%}.sync-heading[_ngcontent-%COMP%]{font-size:18px!important;font-family:Agenda-Regular!important;color:#002f3b;margin-top:50px}.sunactiv[_ngcontent-%COMP%]{--background: url(sunactive-background.4b01736817791c32.jpg) no-repeat center center / cover;background-size:cover;background-repeat:no-repeat;height:100%;background-position:bottom}.source-name[_ngcontent-%COMP%]{font-size:18px!important;font-family:Agenda-Regular!important;color:#002f3b;text-align:center;margin:0}.source-name-image[_ngcontent-%COMP%]{width:35%}.source-name-image-apple[_ngcontent-%COMP%]{width:40%}.alert-title.sc-ion-alert-md[_ngcontent-%COMP%]{font-size:22px!important}"]}),i})()}];let U=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[p.Bz.forChild(C),p.Bz]}),i})(),b=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[f.ez,S.u5,o.Pc,v.aw,U]}),i})()}}]);