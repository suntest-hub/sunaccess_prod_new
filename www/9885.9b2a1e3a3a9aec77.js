"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9885],{29885:(N,y,r)=>{r.r(y),r.d(y,{UpdateDirectDebitPageModule:()=>w});var f=r(54463),S=r(36895),h=r(24006),c=r(48058),D=r(64228),d=r(22727),i=r(98274),P=r(53025),b=r(42599),L=r(9999),v=r(43485),O=r(42045);const M=[{path:"",component:(()=>{class s{constructor(e,t,o,g,u,l,p){this.fb=e,this.utils=t,this.updateDirectDebitDetail=o,this.logger=g,this.translate=u,this.config=l,this.theInAppBrowser=p,this.isShowingLoader=!1,this.canTryAgain=!1,this.policyList=[],this.selectedPolicyIndex=0,this.disclaimer_terms=!0,this.merchantReturnURL="https://bpp1.sunlifemalaysia.com/portal-ui/CUSTOMER/UpdateDirectDebitResults",this.isUATBuild=!0,this.amount="9999.00",this.currencyCode="MYR",this.custIp="127.0.0.0",this.pageTimeout=780,this.alertButtons=[{text:this.translate.instant("make_payment.okBtn"),handler:()=>{}}],this.updateDirectDebitForm=e.group({disclaimer:[{value:!0,disabled:!1}],selectPolicy:this.fb.array([])}),this.username=this.utils.getName(),this.getPolicyList()}ionViewDidLoad(){console.log("ionViewDidLoad UpdateDirectDebitPage")}ionViewDidEnter(){this.config.currentPage.pageName="UpdateDirectDebitPage"}checkboxChange(e){this.disclaimer_terms=!!e}showGuideLines(){}getPolicyList(){this.policyList.length>0?(this.isShowingLoader=!1,this.canTryAgain=!1):(this.isShowingLoader=!0,this.utils.isDeviceOnLine()?(this.canTryAgain=!1,this.updateDirectDebitDetail.getDirectDebitPolicyList(this.utils.getUserIdentity()).then(e=>{try{e.responseJSON&&e.responseJSON.statusCode==d.OK?(this.policyList=e.responseJSON.array,this.isShowingLoader=!1):(this.isShowingLoader=!1,this.canTryAgain=!0,this.errorMsg=this.translate.instant("generic_msgs.server_err"))}catch(t){this.isShowingLoader=!1,this.canTryAgain=!0,this.logger.error("loginSuccess catch eror : "+JSON.stringify(t)),this.errorMsg=this.translate.instant("generic_msgs.server_err")}},e=>{this.isShowingLoader=!1,this.canTryAgain=!0,this.errorMsg=this.translate.instant("generic_msgs.server_err")})):(this.isShowingLoader=!1,this.canTryAgain=!0,this.errorMsg=this.translate.instant("generic_msgs.network_err")))}onChange(e,t){const o=this.updateDirectDebitForm.controls.selectPolicy;o.removeAt(0),o.push(new h.NI(e)),this.selectedPolicyIndex=t,this.selectedEncryptedPolicyId=this.policyList[this.selectedPolicyIndex].EncryptedPolicyNumber}submitDirectDebitForm(){this.logger.trace("POST paymnet user details --start"),this.utils.showProgressLoader(),this.utils.isDeviceOnLine()?this.updateDirectDebitDetail.postEMandateInfo(this.selectedEncryptedPolicyId).then(e=>{try{e.responseJSON&&e.responseJSON.statusCode==d.oo?(console.log(e.responseJSON),this.MakeEGHLPayment(e.responseJSON)):(this.logger.error("POST USER payment details : "+JSON.stringify(e)),this.errorMsg=this.translate.instant("generic_msgs.server_err"))}catch(t){this.utils.dissmisProgressLoader(),this.isShowingLoader=!1,this.logger.error("POST USER payment details : "+JSON.stringify(t)),this.errorMsg=this.translate.instant("generic_msgs.server_err")}},e=>{this.utils.dissmisProgressLoader(),this.isShowingLoader=!1,this.logger.error("POST USER payment details : "+JSON.stringify(e)),this.errorMsg=this.utils.handleServiceException(e)}):(this.isShowingLoader=!1,this.errorMsg=this.translate.instant("generic_msgs.network_err"))}MakeEGHLPayment(e){let t,o={location:"yes",hidden:"no",clearcache:"yes",clearsessioncache:"yes",zoom:"yes",hardwareback:"no",mediaPlaybackRequiresUserAction:"no",shouldPauseOnSuspend:"no",closebuttoncaption:"Close",disallowoverscroll:"no",toolbar:"yes",enableViewportScale:"no",allowInlineMediaPlayback:"no",presentationstyle:"pagesheet",fullscreen:"yes",hideurlbar:"yes",hidenavigationbuttons:"yes",toolbarcolor:"#f8f8f8",closebuttoncolor:"#003946"},g="";if(e.inputs.length>0){let l=e.inputs;for(let a=0;a<l.length;a++)g+='<input type="'+l[a].type+'" name="'+l[a].name+'" value="'+l[a].value+'" />';t="data:text/html;base64,"+btoa('<html><head><script>function submitPayment(){document.eMandate.submit();}<\/script></head><body onload="submitPayment()"><form action="'+e.submitUrl+'"  name="eMandate" method="post">'+g+"</form></body></html>");let m=this.theInAppBrowser.create(t,"_blank",o);m.on("loadstart").subscribe(a=>{a.url.includes("bpp1.sunlifemalaysia.com/")&&m.close()}),m.on("exit").subscribe(a=>{console.log("response is "+JSON.stringify(a)),this.utils.dissmisProgressLoader()},a=>{this.utils.dissmisProgressLoader()})}else console.log(JSON.stringify(e)),this.utils.dissmisProgressLoader()}paymentSuccess(){if(this.utils.isDeviceOnLine())this.utils.showProgressLoader(),this.updateDirectDebitDetail.putEMandateResults(this.paymentSuccessResp,this.paymentSeqNo).then(e=>{try{if(this.utils.dissmisProgressLoader(),e.responseJSON)if(e.responseJSON.statusCode==d.yI||e.responseJSON.statusCode==d.OK){let t=e.responseJSON.userMessage||this.translate.instant("make_payment.paymentSuccessService");this.utils.showAlert("",t,!1,this.alertButtons)}else{let t=e.responseJSON.Message||this.translate.instant("make_payment.paymentSuccessService");this.utils.showAlert("",t,!1,this.alertButtons)}}catch(t){this.utils.dissmisProgressLoader(),this.logger.error("loginSuccess catch eror : "+JSON.stringify(t));let o=this.translate.instant("make_payment.tryAgain");this.utils.showAlert("",o,!1,this.alertButtons)}},e=>{let t;this.utils.dissmisProgressLoader(),t=this.utils.handleServiceException(e),this.utils.showAlert("",t,!1,this.alertButtons)});else{this.utils.dissmisProgressLoader();let e=this.translate.instant("generic_msgs.network_err");this.utils.showAlert("",e,!1,this.alertButtons)}}}return s.\u0275fac=function(e){return new(e||s)(i.Y36(h.qu),i.Y36(P.f),i.Y36(b.G),i.Y36(L.U),i.Y36(f.sK),i.Y36(v.i),i.Y36(O.i))},s.\u0275cmp=i.Xpm({type:s,selectors:[["app-update-direct-debit"]],decls:5,vars:0,template:function(e,t){1&e&&(i.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),i._uU(3,"update-direct-debit"),i.qZA()()(),i._UZ(4,"ion-content"))},dependencies:[c.W2,c.Gu,c.wd,c.sr]}),s})()}];let U=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=i.oAB({type:s}),s.\u0275inj=i.cJS({imports:[D.Bz.forChild(M),D.Bz]}),s})(),w=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=i.oAB({type:s}),s.\u0275inj=i.cJS({imports:[S.ez,h.u5,c.Pc,f.aw,h.UX,U]}),s})()}}]);